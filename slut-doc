#!/usr/bin/env node

'use strict';

var fs = require('fs');
var fileHelper = require('./file-helper');

// ================================================

var docBlockRegex = /\/\*{2,}(.|[\r\n])+?\*\//g;
var docItemRegex = /\* @(param|return|private)(.|[\r\n])+?(?=\*( @|\/))/g;
var blockDescRegex = /\/\*{2,}(.|[\r\n])+?(?=\* @)/g;


/**
* Find blocks of documentation (doc block).
* @param {String} text
* @param {RegExp} [pattern = /\/\*{2,}.+\*\//g]
* @return {String[]}
*/
var findBlocks = function (text, pattern) {
    var blocks = [];
    pattern = pattern || docBlockRegex;

    blocks = text.match(pattern);

    return blocks || [];
};

/**
* Find the items, except description.
* @param {String} text
* @return {String[]}
*/
var findDocItems = function (text) {
    var items = text.match(docItemRegex),
        i = 0,
        max = items && items.length;

    // There's no negative lookbehind, so we have to clean
    // up some crap.
    for(; max && i < max; i++) {
        items[i] = items[i].substr(1).trim();
    }

    return items;
};

/**
* @param {String} block
* @return {String}
*/
var getBlockDescription = function (block) {
    var desc = block.match(blockDescRegex);

    // remove all the junk before and after the description
    if (desc) {
        desc = desc[0].replace(/\/\*{2,}(.|[\r\n])+?(?=[a-z])/gi, '').trim();
    }

    return desc || '';
};

// ================================================

// TODO: These should not be public.  This is only for testing.
exports.findBlocks = findBlocks;
exports.findDocItems = findDocItems;
exports.getBlockDescription = getBlockDescription;